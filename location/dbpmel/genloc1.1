#
#  This is a set of extensions to css3.0.  The entries here do not
#  stand alone as these tables mainly reference attributes defined
#  in css3.0.  These extensions would normally be used with the 
#  database descriptor as:  css3.0:PMEL1.0
#
#  These extensions serve three purposes.  First, the tables define
#  predicted values for measurements in the arrival table that 
#  are based on some earth model and a particular travel time calculator.
#  This should allow future software to not be burdened with matching
#  theoretical travel times to data.  That is, these tables can be used
#  to simply show the predicted value without having to recompute it
#  and worry about whether the results will be consistent.  
#  Secondly, they define extension tables used in the genloc implementation
#  of pmel.  Note this final element was added after the first two 
#  because genloc already looked for some of these tables and I (glp)
#  viewed it better to extend this schema patch rather than add the
#  mess of a long string of extensions in the database descriptor. 
#  Finally, it adds tables for dbpmel that relate to multiple event
#  locations and area grids. 
#
#  WARNING:  these extension can collide with other extension
#  schemas.  In particular, the reftek relations are stolen from
#  iceworm1.3  
#

#
# These are defined in a special schema for gclgrids.
# Commented out and kept here for clarity.
#

#Attribute gridname
#	String (15)
#        Format ( "%-15s" )
#        Null ( "-" )
#        Description ( "Name attached to a coordinate grid mesh" )
#        Detail {
#                Several contexts require geographical 2d or 3d 
#		grids.  This attribute ties a name to a name to 
#		a grid that is a useful key for many tables defining
#		such an entity.
#        }
#        ;
#
Attribute gridid
        Integer (8)
        Format ( "%8d" )
        Null ( "-1" )
        Range ( "gridid > 0" )
        Description ( "grid id index" )
        Detail {
		Spatial grids are conveniently indexed with a single
		integer.  This allows the structure of the grid to be
		defined as desired.  This index is also a convenient
		key if the grid is defined in a database table instead
		of being stored on disk.
        }
        ;

Attribute dlat
        Real (15)
        Format ( "%15.9lf" )
        Null ( "-999.0000" )
        Range ( "dlat >= -90.0 && dlat <= 90.0" )
        Units ( "Degrees" )
        Description ( "estimated latitude (double precision)" )
        Detail {
                This attribute is the geographic latitude.  Locations
                north of the equator have positive latitudes.  It is
		comparable to css3.0's lat, but has sufficient precision
		for doubles.  css3.0 defines only single precision.
        }
        ;

Attribute dlon
        Real (15)
        Format ( "%15.9lf" )
        Null ( "-999.0000" )
        Range ( "dlon >= -180.0 && dlon <= 180.0" )
        Units ( "Degrees" )
        Description ( "estimated longitude (double precision)" )
        Detail {
                This attribute is the geographic longitude in degrees.
                Longitudes are measured positive east of the Greenwich
                meridian.  It is comparable to css3.0's lat, but has 
		sufficient precision for doubles.  css3.0 defines only 
		single precision.

        }
        ;

Attribute hclat
        Real (15)
        Format ( "%15.9lf" )
        Null ( "-999.0000" )
        Range ( "hclat >= -90.0 && hclat <= 90.0" )
        Units ( "Degrees" )
        Description ( "hypocentroid latitude" )
        Detail {
                Latitude of the hypocentroid of a group of events.
               	Supplement to dlat.
        }
        ;

Attribute hclon
        Real (15)
        Format ( "%15.9lf" )
        Null ( "-999.0000" )
        Range ( "hclon >= -180.0 && hclon <= 180.0" )
        Units ( "Degrees" )
        Description ( "hypocentroid longitude" )
        Detail {
                Latitude of the hypocentroid of a group of events.
               	Supplement to dlat.
        }
        ;

Attribute hcdepth
        Real (9)
        Format ( "%9.4lf" )
        Null ( "-999.0000" )
        Range ( "depth >= 0.0 && depth < 1000.0" )
        Units ( "Kilometers" )
        Description ( "hypocentroid depth" )
        Detail {
                Depth of the hypocentroid of a group of events.
        }
        ;
Attribute ztop
        Real (9)
        Format ( "%9.4lf" )
        Null ( "-999.0000" )
        Range ( "ztop >= -10.0 && ztop < 1000.0" )
        Units ( "Kilometer" )
        Description ( "Top of a depth range" )
        Detail {
                Regions can be specified in terms of a top and bottom
		depth.  This is the top.
        }
        ;

Attribute zbot
        Real (9)
        Format ( "%9.4lf" )
        Null ( "-999.0000" )
        Range ( "zbot >= -10.0 && zbot < 1000.0" )
        Units ( "Kilometer" )
        Description ( "Bottom of a depth range" )
        Detail {
                Regions can be specified in terms of a top and bottom
		depth.  This is the bottom.
        }
        ;

Attribute velocity
        Real (9)
        Format ( "%9.6lf" )
        Null ( "-999.0000" )
        Range ( "velocity > 0.0" )
        Units ( "Kilometers/sec" )
        Description ( "Seismic wave velocity" )
        Detail {
                Generic seismic wave velocity attribute.  Wave type
		should be inferred from association with a phase attribute.
        }
        ;
Attribute dip
        Real ( 5 )
        Format ( "%5.1lf" )
        Description ("Dip of a vector")
        Detail {
            Used for strike and dip of a line segment.
        }
        ;

Attribute emodelx
	Real ( 15 )
	Format ( "%15.6lg" )
	Description ( "Location error bound in x (EW) due to model errors" )
	Null ( "-1.0" )
	Detail {
		Provides a bound estimate on the effect of velocity model
		errors complimentary to conventional covariance estimate.
		This component is for the EW direction in km.
		}
	;

Attribute emodely
	Real ( 15 )
	Format ( "%15.6lg" )
	Description ( "Location error bound in y (NS) due to model errors" )
	Detail {
		Provides a bound estimate on the effect of velocity model
		errors complimentary to conventional covariance estimate.
		This component is for the NS direction in km.
		}
	Null ( "-1.0" )
	;

Attribute emodelz
	Real ( 15 )
	Format ( "%15.6lg" )
	Description ( "Location error bound in depth due to model errors" )
	Detail {
		Provides a bound estimate on the effect of velocity model
		errors complimentary to conventional covariance estimate.
		This component is for the vertical direction in km.
		}
	Null ( "-1.0" )
	;

Attribute emodelt
	Real ( 15 )
	Format ( "%15.6lg" )
	Description ( "Location error bound in origin timedue to model errors" )
	Detail {
		Provides a bound estimate on the effect of velocity model
		errors complimentary to conventional covariance estimate.
		This component is for the origin time in seconds.
		}
	Null ( "-1.0" )
	;

#
#  Used by dbpmel 
#
Attribute pmelrun
	String (5)
        Format ( "%-5s" )
        Null ( "-" )
        Description ( "Run code for dbpmel program" )
        Detail {
		The dbpmel program builds several special output
		tables.  To allow multiple runs with different 
		parameters against a common database we need this
		key in some of these tables.
        }
        ;
Attribute tsc
	Real ( 10 )
	Format ( "%10.3lf" )
	Units ( "Seconds" )
	Description ( "Travel time station correction" )
	Null ( "-1.0" )
	Detail {
		Station corrections are corrections added to a computed
		travel time that are tagged to a particular receiver 
		position.  
		}
	;

Attribute tscref
	Real ( 10 )
	Format ( "%10.3lf" )
	Units ( "Seconds" )
	Description ( "Reference station correction" )
	Null ( "-1.0" )
	Detail {
		Station corrections are corrections added to a computed
		travel time that are tagged to a particular receiver 
		position.  A reference station correction is a concept
		used by pmel to denote a correction formed as the 
		difference between two model realizations.  Normally
		this would be a difference T3d - T1d where T3d is a
		time computed for a 3D model and T1d is time computed
		for a 1D reference model.  
		}
	;
	
Attribute tscbias
	Real ( 10 )
	Format ( "%10.3lf" )
	Units ( "Seconds" )
	Description ( "Bias component of station correction" )
	Null ( "-1.0" )
	Detail {
		Station corrections are corrections added to a computed
		travel time that are tagged to a particular receiver 
		position.  A reference/bias station correction is a concept
		used by pmel to denote a correction used as a bias
		contribute.  That is, a bias is applied that is derived
		from the reference corrections (tsref) and this is the
		component of tsc derived from tsref.   
		}
	;
		
Attribute sswrodgf
	Real ( 15 )
	Format ( "%15.6lg" )
	Range ( "sswrodgf>0.0" )
	Description ( "Normalized sum of squared weighted residuals" )
	Null ( "-1.0" )
	Detail {
		Proper statistical description of a misfit statistic
		for data with variable uncertainties uses a weighting
		of e_i/sigma_i where sigma_i is the estimated uncertainty
		in e_i.  sswrodgf is the sum of squared weighted residuals
		divided by the number of degrees of freedom.  This is 
		a normalized form of rms used with this type of weighting.
		}
	;

Attribute ndgf
	Integer (4)
	Format ( "%4d" )
	Null ("-1")
	Range ( "ndgf>=0")
	Description ( "Number of degrees of freedom" )
	Detail {
		Many statistical metrics require a degrees of freedom
		parameter which is typically number of data - number
		of parameters.  Other contexts may use this to mean
		something different that is consistent with the words.
		}
	;

#
#  Reftek attributes 
#
Attribute reftekchanid
        Integer (10)
        Format ( "%10d" )
        Null ( "-1" )
        Description ( "reftek digitizer channel" )
        Detail {
                Channel number of Reftek digitizer
        }
        ;

Attribute reftekid
        Integer (10)
        Format ( "%10d" )
        Null ( "-1" )
        Description ( "reftek digitizer id" )
        Detail {
                Identification number of Reftek digitizer
        }
        ;

Attribute reftekstream
        Integer (10)
        Format ( "%10d" )
        Null ( "-1" )
        Description ( "reftek digitizer stream" )
        Detail {
                Stream number of Reftek digitizer
        }
        ;
#
# Used for timing table 
#
Attribute clkerr
	Real ( 10 )
	Format ( "%10.6lg" )
	Description ( "Upper bound on clock error" )
	Null ( "-1.0" )
	Units ( "Seconds" )
	Detail {
		Used to provide a measure of the accuracy of a timing
		system.  During a related time period the clock accuracy
		should be presumed to be no worse than this number.
	}
	;

Attribute seedtqual
	Integer (4)
	Format ( "%4d" )
	Null ("-1")
	Description ( "SEED Timing Quality" )
	Detail {
		SEED has a timing quality field specified as a percent
		figure with small percentages indicating a bad clock.
		This attribute stores this form of timing tabulation.
	}
	;

Relation predarr
        Fields (
            arid orid time slow seaz ema esaz dip lddate )
        Primary ( arid  orid  )
        Foreign  ( arid orid )
        Description ( "Earth model predictions of data associated with arrivals" )
        Detail {
                This table has information that connects arrival rows
                to predicted values of related observable based on a
                particular earth model.  It is keyed similar to assoc, but
                the attributes in this relation are all predicted values
                based on some earth model.  This relations can be thought
                of as a supplement to assoc that directly stores predicted
                values of observables rather than residuals.  Note that
                esaz and dip are azimuth and dip of the predicted emergence
                angle of a given arrival in the focal sphere.  esaz is not
                necessarily the same as that stored in assoc which is 
                conventionally the great circle path angle.  Similarly
                seaz and ema are computed from a model, not from simple
                spherical geometry.
        }
        ;

Relation stavel
	Fields (
		sta phase vmodel velocity lddate
	)
	Primary ( sta phase vmodel )
	Foreign ( sta phase vmodel )
	Description ( "Surface velocity of different phases" )
	Detail {
		This table is used to define the surface velocity that
		is to be used for a given velocity model and phase 
		type.  This table allows different surface velocities
		to be defined for each station and phase combination.
		This is needed in computing the emergence angle 
		in the predarr table, but probably has other uses
		in things like time statics.
	}
	;

Relation emodel
	Fields ( 
	    orid emodelx emodely emodelz emodelt lddate
	    )
        Primary ( orid )
	Foreign ( orid )

	Description ( "Velocity model error bound estimates table" )
	Detail {
		This relation holds velocity model error bound
		estimates computed by genloc using theory from
		Pavlis (1986).
	    }
	;

Relation cluster
	Fields ( gridname gridid evid lddate )
	Primary ( gridname gridid evid )
	Foreign ( gridid evid )
	Description ( "linking table to define event clusters" )
	Detail {
		This table is used to link a set of events to a grid 
		point that defines a particular point in space. 
		Normally many evids are linked to each gridid.
	}
	;

Relation gridscor
	Fields (
		sta phase gridname gridid pmelrun tsc tscref tscbias lddate )
	Primary ( sta phase gridname gridid pmelrun )
	Foreign ( gridid pmelrun )
	Detail {
		This is this one of two primary output tables of dbpmel.
		It contains the station corrections computed for each
		station/phase combination.
	}
	;
	
Relation gridstat
	Fields ( gridname gridid pmelrun sswrodgf ndgf sdobs lddate )
	Primary ( gridname gridid pmelrun )
	Foreign ( gridid )
	Description ( "Location misfit statistics for multievent location" )
	Detail {
		Used by dbpmel to save misfit statistics for different
		grid points.  These statistics are ensemble averages for
		all events associated with a given grid point defined
		by gridid and gridname. 
	}
	;

Relation hypocentroid
	Fields (
		gridname gridid dlat dlon depth hclat hclon hcdepth 
		nass delta ztop zbot lddate

	)
	Primary ( gridname gridid )
	Description ( "hypocentroid of a group of seismic events" )
	Detail {
		The center of mass of a group of seismic events is a 
		useful concept called a hypocentroid.  This table 
		stores the hypocentroid corresponding to a cluster of
		events tied to a particular grid point defined with the
		reference point dlat, lon, depth. nass is the number of 
		events within a distance range delta from dlat,dlon and 
		within a depth interval zupper to zlower.
	}
	;
	
Relation pmelruns
	Fields (
		pmelrun vmodel vmodel3d dir dfile lddate )
	Primary ( pmelrun )
	Detail {
		This is a special working table for dbpmel that is 
		used to save the large set of parameters that control
		it's operation.  The run code, pmelrun, is used as a
		key in several other tables to allow multiple runs
		to be stored in a single database.
	}
	;
	


#
#  These are copied from iceworm1.3  but I added time fields
#
Relation reftekchan
        Fields ( reftekid reftekchanid reftekstream 
		time endtime chan samprate lddate )
        Primary ( reftekid reftekchanid reftekstream time::endtime )
        Foreign ( chan )
        Description ( "Assigns reftek channel numbers to channel codes" )
        Detail {
                This table associates each Reftek channel number and stream
                with the appropriate channel code.
        }
        ;

Relation reftekdas
        Fields ( reftekid sta time endtime net lddate )
        Primary ( reftekid time::endtime )
        Alternate ( sta )
        Defines reftekid
        Description ( "translation table from Reftek digitizer ID to station cod
e" )
        Detail {
                This table associates each Reftek digitizer ID number
                with the assigned station code, as well as the network
                code if appropriate.
        }
        ;

Relation timing
	Fields ( sta time endtime clkerr seedtqual lddate)
	Primary ( sta time::endtime )
	Description ( "Timing accuracy table" )
	Detail {
		This table defines figures on the absolute accuracy of
		a clock during a given time period.  Unlisted time 
		intervals for a given station should be interpreted as 
		having high accuracy clocks to avoid excessive database
		patching.
	}
	;
	
